<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Math & Bricks</title>
    <style>
        :root {
            --primary: #f4d03f;

            --danger: #e74c3c;
            --success: #2ecc71;
            --dark: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }

        #game-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none !important;
        }

        h1 {
            color: var(--dark);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: var(--dark);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        button {
            background: var(--primary);
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.95);
        }

        button.red {
            background: var(--danger);
            color: white;
        }

        #quiz-area {
            font-size: 24px;
            padding: 20px;
        }

        #question {
            font-size: 40px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        input[type="number"] {
            font-size: 24px;
            padding: 5px;
            width: 100px;
            text-align: center;
        }

        .bag {
            border: 2px dashed var(--dark);
            padding: 20px;
            margin: 10px;
            display: inline-block;
            cursor: pointer;
        }

        .bag:hover {
            background-color: #eee;
        }

        #canvas-container {
            margin-top: 20px;
            overflow: auto;
        }

        canvas {
            border: 1px solid #ccc;
            cursor: crosshair;
        }

        #palette {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .brick-btn {
            width: 30px;
            height: 30px;
            border: 2px solid #fff;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        }

        .brick-btn.selected {
            border: 2px solid var(--dark);
            transform: scale(1.2);
        }

        .locked {
            opacity: 0.3;
            pointer-events: none;
            position: relative;
        }

        .locked::after {
            content: "ðŸ”’";
            position: absolute;
            top: 0;
            left: 0;
            font-size: 12px;
        }
    </style>
</head>

<body>

    <div id="game-container">
        <h1>Math & Bricks Builder</h1>

        <div class="stats">
            <span id="coin-display">Coins: 0</span>
            <span id="inventory-display">Bricks Unlocked: 1/6</span>
        </div>

        <div id="nav">
            <button onclick="showSection('quiz')">Go to Quiz</button>
            <button onclick="showSection('shop')">Brick Shop</button>
            <button onclick="showSection('builder')">Builder Mode</button>
        </div>

        <hr>

        <div id="quiz-section" class="hidden">
            <h2>Arithmetic Quiz</h2>
            <p>Solve quickly for bonus coins!</p>
            <div id="quiz-area">
                <div id="timer">Time: 0s</div>
                <div id="question">2 + 2 = ?</div>
                <input type="number" id="answer-input" placeholder="?">
                <br><br>
                <button onclick="checkAnswer()">Submit</button>
            </div>
            <div id="feedback"></div>
        </div>

        <div id="shop-section" class="hidden">
            <h2>Brick Shop</h2>
            <p>Buy a Mystery Bag for <strong>50 Coins</strong></p>
            <div class="bag" onclick="buyBag()">
                <h3>ðŸ“¦ Mystery Bag</h3>
                <p>Contains 1 Random Color</p>
            </div>
            <p id="shop-message"></p>
        </div>

        <div id="builder-section" class="hidden">
            <h2>Construction Zone</h2>
            <p>Select a color and click the grid to build.</p>
            <p>Double click to delete</p>
            <div id="palette">
            </div>

            <button class="red" onclick="clearCanvas()">Clear Board</button>

            <div id="canvas-container">
                <canvas id="buildCanvas" width="400" height="400"></canvas>
            </div>
        </div>
    </div>

    <script>
        /**
         * GAME STATE
         */
        const state = {
            coins: 100, // Starting coins
            inventory: ['#e74c3c'], // Start with Red unlocked
            allColors: ['#e74c3c', '#3498db', '#f1c40f', '#2ecc71', '#9b59b6', '#34495e'],
            currentQuestion: {},
            startTime: 0,
            selectedColor: '#e74c3c'
        };

        const elements = {
            coins: document.getElementById('coin-display'),
            inv: document.getElementById('inventory-display'),
            quiz: document.getElementById('quiz-section'),
            shop: document.getElementById('shop-section'),
            builder: document.getElementById('builder-section'),
            palette: document.getElementById('palette'),
            canvas: document.getElementById('buildCanvas')
        };

        const ctx = elements.canvas.getContext('2d');
        const GRID_SIZE = 20; // Size of one brick on canvas

        /**
         * CORE FUNCTIONS
         */

        function updateUI() {
            elements.coins.innerText = `Coins: ${state.coins}`;
            elements.inv.innerText = `Bricks Unlocked: ${state.inventory.length}/${state.allColors.length}`;
            renderPalette();
        }

        function showSection(id) {
            // Hide all
            elements.quiz.classList.add('hidden');
            elements.shop.classList.add('hidden');
            elements.builder.classList.add('hidden');

            // Show selected
            document.getElementById(id + '-section').classList.remove('hidden');

            if (id === 'quiz') generateQuestion();
            if (id === 'builder') drawGrid();
        }

        //Quiz
        function generateQuestion() {
            const num1 = Math.floor(Math.random() * 12) + 1;
            const num2 = Math.floor(Math.random() * 12) + 1;
            const ops = ['+', '-', '*'];
            const op = ops[Math.floor(Math.random() * ops.length)];

            state.currentQuestion = {
                answer: eval(`${num1} ${op} ${num2}`),
                str: `${num1} ${op} ${num2}`
            };

            document.getElementById('question').innerText = `${state.currentQuestion.str} = ?`;
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
            document.getElementById('feedback').innerText = '';
            state.startTime = Date.now();
        }

        function checkAnswer() {
            const userAns = parseInt(document.getElementById('answer-input').value);
            const timeTaken = (Date.now() - state.startTime) / 1000;
            const feedback = document.getElementById('feedback');

            if (userAns === state.currentQuestion.answer) {
                // Reward Formula: Base 10 + Speed Bonus
                let reward = 10;
                if (timeTaken < 3) reward += 10; // Fast bonus
                else if (timeTaken < 5) reward += 5;

                state.coins += reward;
                feedback.innerText = `Correct! +${reward} coins`;
                feedback.style.color = "green";
                updateUI();
                setTimeout(generateQuestion, 1000); // Next question after 1s
            } else {
                feedback.innerText = `Wrong! It was ${state.currentQuestion.answer}`;
                feedback.style.color = "red";
            }
        }

        document.getElementById('answer-input').addEventListener("keypress", function (event) {
            if (event.key === "Enter") checkAnswer();
        });
        //Shop
        function buyBag() {
            const price = 50;
            const msg = document.getElementById('shop-message');

            if (state.coins >= price) {
                if (state.inventory.length >= state.allColors.length) {
                    msg.innerText = "You have unlocked every brick color!";
                    return;
                }

                state.coins -= price;

                let newColor;
                do {
                    newColor = state.allColors[Math.floor(Math.random() * state.allColors.length)];
                } while (state.inventory.includes(newColor));

                state.inventory.push(newColor);
                msg.innerText = `Unboxed a new color!`;
                msg.style.color = newColor;
                msg.style.textShadow = "1px 1px 1px black";

                updateUI();
            } else {
                msg.innerText = "Not enough coins!";
                msg.style.color = "red";
            }
        }

        //Build
        let gridData = []; // Stores placed blocks

        function drawGrid() {
            ctx.clearRect(0, 0, elements.canvas.width, elements.canvas.height);

            ctx.strokeStyle = '#eee';
            for (let x = 0; x <= elements.canvas.width; x += GRID_SIZE) {
                ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, elements.canvas.height); ctx.stroke();
            }
            for (let y = 0; y <= elements.canvas.height; y += GRID_SIZE) {
                ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(elements.canvas.width, y); ctx.stroke();
            }

            gridData.forEach(block => {
                ctx.fillStyle = block.color;
                ctx.fillRect(block.x, block.y, GRID_SIZE, GRID_SIZE);

                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.beginPath();
                ctx.arc(block.x + GRID_SIZE / 2, block.y + GRID_SIZE / 2, GRID_SIZE / 4, 0, 2 * Math.PI);
                ctx.fill();
            });
        }

        function renderPalette() {
            elements.palette.innerHTML = '';
            state.allColors.forEach(color => {
                const btn = document.createElement('div');
                btn.className = 'brick-btn';
                btn.style.backgroundColor = color;

                if (!state.inventory.includes(color)) {
                    btn.classList.add('locked');
                } else {
                    btn.onclick = () => {
                        state.selectedColor = color;
                        document.querySelectorAll('.brick-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                    };
                    if (color === state.selectedColor) btn.classList.add('selected');
                }
                elements.palette.appendChild(btn);
            });
        }

        elements.canvas.addEventListener('mousedown', (e) => {
            const rect = elements.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const gridX = Math.floor(x / GRID_SIZE) * GRID_SIZE;
            const gridY = Math.floor(y / GRID_SIZE) * GRID_SIZE;

            // Check if block exists there (simple toggle: click to add, click again to remove?)


            gridData = gridData.filter(b => b.x !== gridX || b.y !== gridY);

            gridData.push({ x: gridX, y: gridY, color: state.selectedColor });

            drawGrid();
        });
        elements.canvas.addEventListener('dblclick', (e) => {
            const rect = elements.canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const gridX = Math.floor(x / GRID_SIZE) * GRID_SIZE;
            const gridY = Math.floor(y / GRID_SIZE) * GRID_SIZE;
            gridData = gridData.filter(b => b.x !== gridX || b.y !== gridY);
            drawGrid();
        });
        function clearCanvas() {
            if (confirm("Clear your creation?")) {
                gridData = [];
                drawGrid();
            }
        }

        updateUI();
        showSection('quiz'); 
    </script>

</body>

</html>